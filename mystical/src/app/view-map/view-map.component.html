<div class="header">
    <div class="header-left">
        <img src="assets/icons/arrow_back.svg" class="back" (click)="goBack()" />
        <p class="title">Trishul</p>
    </div>
    <div class="header-right">
        <button class="btn" draggable="true" (dragstart)="onDragStart($event)">
            Add Marker
        </button>

        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" style="background-color: #008CBA;" type="button"
                data-bs-toggle="dropdown">
                Show Actions
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item" (click)="showView('logs')">Show Detections</a></li>
                <li><a class="dropdown-item" (click)="showView('markers')">Show Markers</a></li>
                <li><a class="dropdown-item" (click)="showView('drawings')">Show Drawings</a></li>
            </ul>
        </div>

        <app-user-profile class="mt-1"></app-user-profile>
        <!-- <button class="btn" style="background-color: #b23b3b;" (click)="logoutFn()">Logout</button> -->
    </div>
</div>

<div class="row full-height">
    <div [ngClass]="selectedView ? 'col-10' : 'col-12'">
        <div #mapContainer id="map" class="map-container"></div>
    </div>

    <!-- Show detected objects -->
    <div class="col-2 float-end mt-2 scroll-panel" *ngIf="selectedView == 'logs'">
        <ng-container *ngTemplateOutlet="header; context: {
        label: 'Detected Objects',
        count: detectedObjectCount,
        message: 'No object detected'
    }">
        </ng-container>
        <ng-container *ngFor="let obj of detectedObjectList">
            <ng-container *ngIf="obj.type != TYPE_CAMERA ">
                <ng-container *ngTemplateOutlet="detectedObjects; context: {
        label: obj.label,
        latitude: obj.latitude,
        longitude: obj.longitude,
        id: obj.id,
        view: selectedView
      }">
                </ng-container>
            </ng-container>
        </ng-container>
    </div>

    <!-- Show Markers -->
    <div class="col-2 float-end mt-2 scroll-panel" *ngIf="selectedView === 'markers'">
        <ng-container *ngTemplateOutlet="header; context: {
        label: 'Marker List',
        count: customMarkerList.length,
        message: ' No Marker added'
    }">
        </ng-container>
        <ng-container *ngFor="let obj of customMarkerList">
            <ng-container *ngTemplateOutlet="showMarkerList; context: {
        label: obj.label,
        latitude: obj.latitude,
        longitude: obj.longitude,
        id: obj.id,
        view: selectedView
      }">
            </ng-container>
        </ng-container>
    </div>

    <!-- Show Drawings -->
    <div class="col-2 float-end mt-2 scroll-panel" *ngIf="selectedView === 'drawings'">
        <ng-container *ngTemplateOutlet="header; context: {
        label: 'Drawing List',
        count: drawingList.length,
        message: ' No Drawing added'
    }">
        </ng-container>
        <ng-container *ngFor="let obj of drawingList">
            <ng-container *ngTemplateOutlet="showDrawingList; context: {
        label: obj.label,
        shapeName: obj.shapeName,
        id: obj.id,
        latlng: obj.latlng
      }">
            </ng-container>
        </ng-container>
    </div>

</div>

<div class="coordinates ">
    {{ latitude | number: '1.4-5'}}, {{ longitude | number: '1.4-5'}}
</div>

<ng-template #header let-label="label" let-count="count" let-message="message">
    <div class="row">
        <div class="col-sm-10">
            <h2 class="title"> {{ label }}</h2>
        </div>
        <div class="col-sm-2">
            <img src="assets/icons/close.svg" style="height: 30px;" (click)="showView('')">
        </div>
    </div>
    <div *ngIf="count == 0" class="text-center">
        {{ message }}
    </div>
</ng-template>

<ng-template #detectedObjects let-label="label" let-longitude="longitude" let-latitude="latitude" let-id="id">
    <div class="row mt-2">
        <div class="col-2">
            <img src="assets/icons/pin_drop.svg" class="iconSize" />
        </div>
        <div class="col-6">
            {{ label }} <br>
            {{ latitude | number: '1.6-7'}} , {{ longitude | number: '1.6-7'}}
        </div>
        <div class="col-4">
            <mat-slide-toggle checked (change)="hideDetectedObjectFromMap(label,id,$event)" color="primary">
            </mat-slide-toggle>
        </div>
    </div>
</ng-template>


<ng-template #showMarkerList let-label="label" let-longitude="longitude" let-latitude="latitude" let-id="id">
    <div class="row mt-2">
        <div class="col-2">
            <img src="assets/icons/marker-icon.png" class="customMarkerIcon" />
        </div>
        <div class="col-6">
            {{ label }} <br>
            {{ latitude | number: '1.6-7'}} , {{ longitude | number: '1.6-7'}}
        </div>
        <div class="col-4">
            <mat-slide-toggle checked (change)="hideMarkerFromMap(label,id,$event)" color="primary">
            </mat-slide-toggle>
            <img src="assets/icons/delete.svg" class="deleteIcon" (click)="deleteCustomMarker(id)" />
        </div>
    </div>
</ng-template>

<ng-template #showDrawingList let-label="label" let-shapeName="shapeName" let-id="id" let-latlng="latlng">
    <div class="row mt-2 mb-3">
        <div class="col-10">
            <span class="fw-bold">
                {{ label }} ({{ shapeName }} ) <br>
            </span>
            <span *ngFor="let obj of latlng">
                {{ obj.lat | number: '1.6-7'}} , {{ obj.lng | number: '1.6-7'}} <br>
            </span>
        </div>
        <div class="col-2">
            <span (click)="deleteDrawing(id)">
                <img src="assets/icons/delete.svg" class="deleteIcon mb-2" />
            </span>
        </div>
    </div>
</ng-template>